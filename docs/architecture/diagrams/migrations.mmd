```mermaid
%% IP2A-Database-v2 — Migration History (Simplified)
%% Shows major migration phases, not individual revision hashes
%% Last Updated: February 3, 2026
%%
%% To regenerate the full dependency graph from Alembic:
%%   alembic history --verbose | grep -E "^Rev|^Parent"
%%   # Or use: alembic heads / alembic branches
%%
%% The auto-generated hex dependency graph (v1.0 of this file) tracked
%% individual revision→parent relationships but was not human-readable.
%% This simplified version shows the logical migration phases instead.

graph TD
    subgraph Phase1["Phase 1: Foundation"]
        M01["0001_baseline<br/><i>Initial schema bootstrap</i>"]
        M02["users, roles, user_roles<br/><i>Auth tables</i>"]
        M03["refresh_tokens<br/><i>JWT session storage</i>"]
        M04["organizations<br/><i>Employers, unions</i>"]
        M05["members<br/><i>Union member records</i>"]
        M06["member_employments<br/><i>Employment history</i>"]
    end

    subgraph Phase2["Phase 2: Union Operations"]
        M07["salt_activities<br/><i>Organizing campaigns</i>"]
        M08["benevolence_applications<br/><i>Financial assistance</i>"]
        M09["grievances<br/><i>Complaint tracking</i>"]
        M10["audit_logs<br/><i>Immutable audit trail</i>"]
        M11["member_notes<br/><i>Staff notes + visibility</i>"]
    end

    subgraph Phase3["Phase 3: Training"]
        M12["courses, cohorts<br/><i>Training program structure</i>"]
        M13["students<br/><i>FK → members</i>"]
        M14["enrollments, grades<br/><i>Student progress</i>"]
        M15["instructors, instructor_cohorts<br/><i>Association Object pattern</i>"]
    end

    subgraph Phase4["Phase 4: Documents"]
        M16["documents<br/><i>File metadata + S3 paths</i>"]
    end

    subgraph Phase5["Phase 5: Dues & Payments"]
        M17["dues_rates, dues_periods<br/><i>Billing structure</i>"]
        M18["dues_payments<br/><i>Payment records</i>"]
        M19["dues_adjustments<br/><i>Waivers, credits</i>"]
        M20["stripe_fields<br/><i>Stripe session IDs, webhook data</i>"]
    end

    subgraph Phase6["Phase 6: Grants & Compliance"]
        M21["grant_enrollments<br/><i>Grant compliance tracking</i>"]
    end

    subgraph Phase7["Phase 6+: Schema Refinements"]
        M22["audit_immutability_trigger<br/><i>Prevent UPDATE/DELETE on audit_logs</i>"]
        M23["locked_until_field<br/><i>User lockout as datetime (not boolean)</i>"]
        M24["various_indexes<br/><i>Performance indexes for production</i>"]
    end

    %% Dependencies flow top-to-bottom
    M01 --> M02 --> M03
    M01 --> M04 --> M05 --> M06
    M05 --> M07
    M05 --> M08
    M05 --> M09
    M04 --> M09
    M02 --> M10
    M05 --> M11

    M05 --> M13
    M12 --> M14
    M13 --> M14
    M12 --> M15

    M02 --> M16

    M05 --> M18
    M17 --> M18
    M18 --> M19
    M18 --> M20

    M13 --> M21

    M10 --> M22
    M02 --> M23
    M18 --> M24

    %% Styling
    classDef foundation fill:#4ade80,stroke:#16a34a,color:#000
    classDef ops fill:#f97316,stroke:#ea580c,color:#000
    classDef training fill:#a78bfa,stroke:#7c3aed,color:#000
    classDef docs fill:#60a5fa,stroke:#2563eb,color:#000
    classDef dues fill:#34d399,stroke:#059669,color:#000
    classDef grants fill:#fbbf24,stroke:#d97706,color:#000
    classDef refine fill:#94a3b8,stroke:#64748b,color:#000

    class M01,M02,M03,M04,M05,M06 foundation
    class M07,M08,M09,M10,M11 ops
    class M12,M13,M14,M15 training
    class M16 docs
    class M17,M18,M19,M20 dues
    class M21 grants
    class M22,M23,M24 refine
```
