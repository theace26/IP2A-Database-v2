{% extends "_base_report.html" %}

{% block title %}Daily Dispatch Log{% endblock %}
{% block subtitle %}
{% if date_range.start == date_range.end %}
{{ date_range.start.strftime('%A, %B %d, %Y') }}
{% else %}
{{ date_range.start.strftime('%m/%d/%Y') }} - {{ date_range.end.strftime('%m/%d/%Y') }}
{% endif %}
{% endblock %}

{% block content %}
<div class="summary-box">
    <strong>Total Dispatches:</strong> {{ total_dispatches }}
    &nbsp;&nbsp;|&nbsp;&nbsp;
    <strong>Books:</strong> {{ by_book_count|length }}
    &nbsp;&nbsp;|&nbsp;&nbsp;
    <strong>Employers:</strong> {{ by_employer_count|length }}
</div>

{% if by_book_count %}
<div class="summary-section">
    <strong>By Book:</strong>
    {% for book_name, count in by_book_count.items() %}
    <span class="stat-chip">{{ book_name }}: {{ count }}</span>
    {% endfor %}
</div>
{% endif %}

{% if dispatches %}
<table>
    <thead>
        <tr>
            <th style="text-align: center;">#</th>
            <th>Date/Time</th>
            <th>Member</th>
            <th>Card #</th>
            <th>Book</th>
            <th>Employer</th>
            <th>Type</th>
            <th style="text-align: center;">Check?</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody>
        {% for d in dispatches %}
        <tr>
            <td style="text-align: center;">{{ d.dispatch_id }}</td>
            <td>{{ d.dispatch_date.strftime('%m/%d/%Y %I:%M %p') if d.dispatch_date else 'N/A' }}</td>
            <td>{{ d.member_name }}</td>
            <td style="font-family: monospace;">{{ d.member_card }}</td>
            <td>{{ d.book_name }}</td>
            <td>{{ d.employer_name }}</td>
            <td>
                {% if d.dispatch_type == 'short_call' %}
                <span class="badge badge-warning">Short Call</span>
                {% elif d.dispatch_type == 'by_name' %}
                <span class="badge badge-info">By Name</span>
                {% else %}
                Regular
                {% endif %}
            </td>
            <td style="text-align: center;">
                {% if d.generates_checkmark %}
                <span class="badge badge-error">Yes</span>
                {% else %}
                No
                {% endif %}
            </td>
            <td>
                <span class="status-{{ d.status }}">{{ d.status|title }}</span>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p style="text-align: center; color: #666; margin-top: 2rem;">No dispatches found for this date range.</p>
{% endif %}

<style>
    .summary-section {
        margin: 1rem 0;
        padding: 0.5rem;
        background: #f5f5f5;
        border-radius: 4px;
    }
    .stat-chip {
        display: inline-block;
        margin: 0.25rem;
        padding: 0.25rem 0.5rem;
        background: #e0e0e0;
        border-radius: 3px;
        font-size: 0.85rem;
    }
    .badge {
        display: inline-block;
        padding: 0.15rem 0.4rem;
        border-radius: 3px;
        font-size: 0.75rem;
        font-weight: 600;
    }
    .badge-warning { background: #fef3cd; color: #856404; }
    .badge-info { background: #d1ecf1; color: #0c5460; }
    .badge-error { background: #f8d7da; color: #721c24; }
    .status-dispatched { color: #0c5460; }
    .status-working { color: #155724; }
    .status-completed { color: #155724; }
    .status-terminated { color: #721c24; }
</style>
{% endblock %}
