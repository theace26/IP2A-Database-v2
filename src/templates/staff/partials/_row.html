{# Single user row - can be swapped via HTMX after actions #}
{# User model has: email, first_name, last_name, is_active, locked_until, last_login, roles (property) #}

<tr class="hover" id="user-row-{{ user.id }}">
    <td>
        <label>
            <input type="checkbox" class="checkbox checkbox-sm" name="selected_users" value="{{ user.id }}" />
        </label>
    </td>
    <td>
        <div class="flex items-center gap-3">
            <div class="avatar placeholder">
                <div class="bg-neutral text-neutral-content rounded-full w-10">
                    <span class="text-sm">
                        {{ user.first_name[0] | upper if user.first_name else user.email[0] | upper }}{{ user.last_name[0] | upper if user.last_name else '' }}
                    </span>
                </div>
            </div>
            <div>
                <div class="font-bold">
                    {% if user.first_name or user.last_name %}
                        {{ user.first_name or '' }} {{ user.last_name or '' }}
                    {% else %}
                        <span class="text-base-content/50">(No name)</span>
                    {% endif %}
                </div>
                <div class="text-sm text-base-content/60">{{ user.email }}</div>
            </div>
        </div>
    </td>
    <td>
        <div class="flex flex-wrap gap-1">
            {% for role in user.roles %}
            <span class="badge badge-{{ 'primary' if role.name == 'admin' else 'secondary' if role.name == 'officer' else 'accent' if role.name == 'staff' else 'ghost' }} badge-sm">
                {{ role.name }}
            </span>
            {% endfor %}
            {% if not user.roles %}
            <span class="badge badge-ghost badge-sm">No roles</span>
            {% endif %}
        </div>
    </td>
    <td>
        {% set is_locked = user.locked_until and user.locked_until >= now() %}
        {% if is_locked %}
        <span class="badge badge-error gap-1">
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
            </svg>
            Locked
        </span>
        {% elif not user.is_active %}
        <span class="badge badge-warning gap-1">Inactive</span>
        {% else %}
        <span class="badge badge-success gap-1">
            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="4"/>
            </svg>
            Active
        </span>
        {% endif %}
    </td>
    <td>
        <div class="text-sm">
            {% if user.last_login %}
            {{ user.last_login.strftime('%b %d, %Y') }}
            <div class="text-xs text-base-content/50">{{ user.last_login.strftime('%I:%M %p') }}</div>
            {% else %}
            <span class="text-base-content/50">Never</span>
            {% endif %}
        </div>
    </td>
    <td>
        <div class="flex gap-1">
            <!-- Quick Edit Button -->
            <button
                class="btn btn-ghost btn-sm"
                hx-get="/staff/{{ user.id }}/edit"
                hx-target="#modal-content"
                hx-swap="innerHTML"
                onclick="document.getElementById('edit-modal').showModal()"
                title="Quick Edit"
            >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                </svg>
            </button>

            <!-- View Detail Button -->
            <a href="/staff/{{ user.id }}" class="btn btn-ghost btn-sm" title="View Details">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                </svg>
            </a>

            <!-- More Actions Dropdown -->
            <div class="dropdown dropdown-end">
                <label tabindex="0" class="btn btn-ghost btn-sm">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"/>
                    </svg>
                </label>
                <ul tabindex="0" class="dropdown-content z-[1] menu menu-sm p-2 shadow-lg bg-base-100 rounded-box w-48">
                    {% set is_locked = user.locked_until and user.locked_until >= now() %}
                    {% if is_locked %}
                    <li>
                        <button
                            hx-post="/staff/{{ user.id }}/unlock"
                            hx-target="#user-row-{{ user.id }}"
                            hx-swap="outerHTML"
                            class="text-success"
                        >
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"/>
                            </svg>
                            Unlock Account
                        </button>
                    </li>
                    {% else %}
                    <li>
                        <button
                            hx-post="/staff/{{ user.id }}/lock"
                            hx-target="#user-row-{{ user.id }}"
                            hx-swap="outerHTML"
                            hx-confirm="Are you sure you want to lock this account?"
                            class="text-warning"
                        >
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                            </svg>
                            Lock Account
                        </button>
                    </li>
                    {% endif %}
                    <li>
                        <button
                            hx-post="/staff/{{ user.id }}/reset-password"
                            hx-target="#toast-container"
                            hx-swap="innerHTML"
                            hx-confirm="Send password reset email to {{ user.email }}?"
                        >
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/>
                            </svg>
                            Reset Password
                        </button>
                    </li>
                    <div class="divider my-1"></div>
                    <li>
                        <button
                            hx-delete="/staff/{{ user.id }}"
                            hx-target="#user-row-{{ user.id }}"
                            hx-swap="outerHTML swap:500ms"
                            hx-confirm="Are you sure you want to delete this user? This action cannot be undone."
                            class="text-error"
                        >
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                            </svg>
                            Delete User
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </td>
</tr>
