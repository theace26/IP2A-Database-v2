{% extends "base.html" %}

{% block title %}Morning Referral{% endblock %}

{% block content %}
<div class="flex justify-between items-center mb-6">
    <div>
        <h1 class="text-2xl font-bold">Morning Referral</h1>
        <p class="text-base-content/60">Process overnight bids for {{ time_context.current_time.strftime('%B %d, %Y') }}</p>
    </div>
    <div class="flex items-center gap-2">
        <div class="badge {{ time_context.bidding_badge.class }} badge-lg">
            {{ time_context.bidding_badge.label }}
        </div>
        {% if not time_context.bidding_open and pending_bids %}
        <button class="btn btn-primary btn-sm"
                hx-post="/dispatch/morning-referral/process-all"
                hx-target="#referral-results"
                hx-confirm="Process all valid bids? This cannot be undone.">
            Process All Bids
        </button>
        {% endif %}
    </div>
</div>

{% if time_context.bidding_open %}
<!-- Bidding Still Open -->
<div class="alert alert-info mb-6">
    <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current flex-shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
    </svg>
    <div>
        <h3 class="font-bold">Bidding Window Open</h3>
        <p>Members can still submit bids. Processing will be available after 7:00 AM.</p>
    </div>
</div>
{% endif %}

{% if time_context.past_cutoff %}
<!-- Past Cutoff Warning -->
<div class="alert alert-warning mb-6">
    <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current flex-shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
    </svg>
    <div>
        <h3 class="font-bold">Past 3 PM Cutoff</h3>
        <p>Requests received after 3 PM will not be included in tomorrow's morning referral.</p>
    </div>
</div>
{% endif %}

<!-- Bid Queue -->
<div class="card bg-base-100 shadow-md">
    <div class="card-body">
        <h2 class="card-title">Pending Bids by Request</h2>

        <div id="bid-queue"
             hx-get="/dispatch/partials/bid-queue"
             hx-trigger="load"
             hx-swap="innerHTML">
            <div class="skeleton h-96 w-full"></div>
        </div>
    </div>
</div>

<!-- Processing Results -->
<div id="referral-results" class="mt-6"></div>

{% endblock %}
